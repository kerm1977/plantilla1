<!-- AQUI NO PUEDE ESTAR INCRUSTADO CSS NI JS SOLO HTML Y LAS CLASES Y FUNCIONES HEREDADAS DE BASE.HTML  -->

{% extends 'base.html' %}
{% block title %}{{ _('Ver Contactos') }}{% endblock %}
{% block content %}
<div class="container is-max-desktop p-4" style="margin-top: 100px;">
    <div class="columns is-centered">
        <div class="column is-11-desktop is-10-tablet">
            <div class="contact-list-container">
                <div class="has-text-centered mb-4">
                    <h2 class="title is-4 has-text-warning">{{ _('Lista de Contactos') }}</h2>
                    {% if user_count is defined %}
                        <p class="subtitle is-6 has-text-grey-light mb-0">
                            {% if search_query %}
                                {{ _('Se encontraron %(user_count)s usuarios para "%(search_query)s"', user_count=user_count, search_query=search_query) }}
                            {% else %}
                                {{ _('%(user_count)s usuarios registrados en total', user_count=user_count) }}
                            {% endif %}
                        </p>
                    {% endif %}
                </div>

                {# Formulario de búsqueda #}
                <div class="mb-4">
                    <form action="{{ url_for('contactos.ver_contactos') }}" method="GET">
                        <div class="field has-addons">
                            <div class="control is-expanded">
                                <input class="input" type="text" name="search_query" placeholder="{{ _('Buscar por nombre, teléfono, email, etc.') }}" value="{{ search_query if search_query else '' }}">
                            </div>
                            <div class="control">
                                <button type="submit" class="button is-warning is-outlined">{{ _('Buscar') }}</button>
                            </div>
                            {% if search_query %}
                            <div class="control">
                                <a href="{{ url_for('contactos.ver_contactos') }}" class="button is-light is-outlined">{{ _('Limpiar') }}</a>
                            </div>
                            {% endif %}
                        </div>
                    </form>
                </div>

                {% if users %}
                    {# Nueva Vista de Lista simplificada #}
                    <div id="list-view" class="list-container">
                        {% for user in users %}
                        <div class="media is-align-items-center p-3">
                            <figure class="media-left is-flex is-align-items-center">
                                <a href="{{ url_for('contactos.ver_detalle', user_id=user.id) }}">
                                    <p class="image is-64x64 is-rounded">
                                        <img src="{{ url_for('static', filename=user.avatar_url if user.avatar_url else 'uploads/avatars/default.png') }}" alt="{{ _('Avatar de %(username)s', username=user.username) }}" class="is-rounded">
                                    </p>
                                </a>
                            </figure>
                            <div class="media-content">
                                <a href="{{ url_for('contactos.ver_detalle', user_id=user.id) }}">
                                    <p class="title is-5 mb-1">{{ user.nombre | title }} {{ user.primer_apellido | title }} {{ user.segundo_apellido | title if user.segundo_apellido  else '' }}</p>
                                    <p class="subtitle is-7 has-text-grey">@{{ user.username }}</p>
                                </a>
                            </div>
                            <div class="media-right">
                                <a href="{{ url_for('contactos.ver_detalle', user_id=user.id) }}" class="button is-warning is-small is-outlined">
                                    {{ _('Ver detalles') }}
                                </a>
                            </div>
                        </div>
                        <hr class="my-0">
                        {% endfor %}
                    </div>

                {% else %}
                    <div class="notification is-light">
                        {% if search_query %}
                            {{ _('No se encontraron contactos para la búsqueda "%(search_query)s".', search_query=search_query) }}
                        {% else %}
                            {{ _('No hay contactos para mostrar.') }}
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{# Botones Flotantes #}
<div class="fab-container">
    {% if current_role == 'Superuser' or current_role == 'Administrador' %}
    <a href="{{ url_for('register') }}" class="button is-warning is-rounded fab-button" title="{{ _('Agregar nuevo contacto') }}">
        <span class="icon is-medium"><i class="fas fa-plus"></i></span>
    </a>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // No es necesario el script de cambio de vista, la página ahora carga directamente en la vista de lista.
});
</script>
{% endblock %}
