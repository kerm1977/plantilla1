<!-- AQUI NO PUEDE ESTAR INCRUSTADO CSS NI JS SOLO HTML Y LAS CLASES Y FUNCIONES HEREDADAS DE BASE.HTML  -->

{% extends 'base.html' %}

{% block title %}{{ _('Detalles de Contacto') }}{% endblock %}

{% block content %}
<div class="container is-max-desktop p-4" style="margin-top: 100px;">
    <div class="columns is-centered">
        <div class="column is-10-desktop is-12-tablet">
            <div>
                <div class="has-text-centered mb-4">
                    <figure class="image is-128x128 is-inline-block is-rounded">
                        <img src="{{ avatar_url }}" alt="{{ _('Avatar de %(username)s', username=user.username) }}" class="is-rounded">
                    </figure>
                    <h3 class="title is-4 has-text-warning">{{ user.nombre | title }} {{ user.primer_apellido | title}} {{ user.segundo_apellido | title if user.segundo_apellido  else '' }}</h3>
                    <p class="subtitle is-6 has-text-grey">@{{ user.username }}</p>
                </div>

                <!-- Bucle para mostrar la información en secciones -->
                {% set sections = {
                    _("Información de Contacto"): [
                        (_("Teléfono"), user.telefono), (_("Email"), user.email), (_("Empresa"), user.empresa),
                        (_("Dirección (Provincia)"), user.direccion), (_("Rol"), user.role), (_("Cédula"), user.cedula)
                    ],
                    _("Información Adicional"): [
                        (_("Fecha de Registro"), user.fecha_registro.strftime('%d/%m/%Y %H:%M') if user.fecha_registro else None),
                        (_("Última Actualización"), user.fecha_actualizacion.strftime('%d/%m/%Y %H:%M') if user.fecha_actualizacion else None),
                        (_("Fecha de Cumpleaños"), user.fecha_cumpleanos.strftime('%d/%m/%Y') if user.fecha_cumpleanos else None),
                        (_("Tipo de Sangre"), user.tipo_sangre), (_("Póliza"), user.poliza), (_("Aseguradora"), user.aseguradora),
                        (_("Actividad"), user.actividad), (_("Capacidad"), user.capacidad), (_("Participación"), user.participacion)
                    ],
                    _("Notas Médicas"): [
                        (_("Alergias"), user.alergias), (_("Enfermedades Crónicas"), user.enfermedades_cronicas)
                    ],
                    _("Contacto de Emergencia"): [
                        (_("Nombre"), user.nombre_emergencia), (_("Teléfono de Emergencia"), user.telefono_emergencia)
                    ]
                } %}

                {% for title, items in sections.items() %}
                    <h4 class="title is-5">{{ title }}</h4>
                    <div class="columns is-multiline">
                        {% for label, value in items %}
                            {% if value %}
                            <div class="column is-half">
                                <p class="is-size-6 has-text-weight-bold">{{ label }}:</p>
                                <p class="is-size-6">{{ value }}</p>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% if not loop.last %}<hr>{% endif %}
                {% endfor %}

                <div class="has-text-centered mt-5">
                    {% if current_role in ['Superuser', 'Administrador'] or current_user_id == user.id %}
                        <a href="{{ url_for('contactos.editar_contacto', user_id=user.id) }}" class="button is-warning is-outlined mr-2"><span class="icon"><i class="fas fa-edit"></i></span><span>{{ _('Editar') }}</span></a>
                    {% endif %}
                    {% if current_role == 'Superuser' %}
                        <button type="button" class="button is-danger" data-target="#confirmDeleteModal" onclick="document.getElementById('confirmDeleteModal').classList.add('is-active');">
                            <span class="icon"><i class="fas fa-trash-alt"></i></span><span>{{ _('Eliminar') }}</span>
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación de Eliminación (Bulma) -->
<div class="modal" id="confirmDeleteModal">
    <div class="modal-background" onclick="document.getElementById('confirmDeleteModal').classList.remove('is-active');"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">{{ _('Confirmar Eliminación') }}</p>
            <button class="delete" aria-label="close" onclick="document.getElementById('confirmDeleteModal').classList.remove('is-active');"></button>
        </header>
        <section class="modal-card-body">
            {{ _('¿Estás seguro de que quieres eliminar a %(nombre)s? Esta acción no se puede deshacer.', nombre=user.nombre) }}
        </section>
        <footer class="modal-card-foot">
            <button class="button" onclick="document.getElementById('confirmDeleteModal').classList.remove('is-active');">{{ _('Cancelar') }}</button>
            <form action="{{ url_for('contactos.eliminar_contacto', user_id=user.id) }}" method="POST" class="is-inline">
                <button type="submit" class="button is-danger">{{ _('Eliminar') }}</button>
            </form>
        </footer>
    </div>
</div>
{% endblock %}
